

<head>
    <title>
Ubuntu/Linux 三板斧 | 🌾大余之道</title>
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />
    <meta http-equiv="Windows-Target" contect="_top" />
    
    
    <link rel="stylesheet" href="/assets/main.dc2e1209.css">
    
    <script>window.__everkm_lang = "zh_CN"</script>
</head>

<body>
    <div class="body-container">
        
        <div class="app-header border-b sticky top-0 z-10 w-full h-[3.5rem] overflow-hidden bg-white flex items-center">
            
    <div class="flex-1 flex justify-between items-center px-4 py-2 lg:px-8">
        <div class="flex items-center">
            

            <div>
                <a href="/" class="text-lg !text-gray-800 font-medium">🌾大余之道</a>
                <span class="hidden lg:inline-block text-gray-600 text-xs"></span>
            </div>
        </div>
        <div class="hidden md:flex space-x-3">
            
    
    <div class="inline-flex items-center">
        <ekm-in-search app-id="1N74YC70XF" api-key="95bb37e3122ee9cb57a8ee0abbd14409" index="dayu_me" only-button="false" class="inline-flex" />
    </div>
    

            
    
    

        </div>

        <div class="flex-shrink-0 ml-4 overflow-hidden md:hidden flex items-center gap-3">
            
    
    <div class="inline-flex items-center">
        <ekm-in-search app-id="1N74YC70XF" api-key="95bb37e3122ee9cb57a8ee0abbd14409" index="dayu_me" only-button="true" class="inline-flex" />
    </div>
    

            
            
<div id="drawer" class="w-6 h-6 flex items-center justify-center active:bg-gray-200 text-[1.4rem]">
    <span class="icon-[material-symbols--dehaze-rounded]"></span>
</div>

            
        </div>

    </div>

        </div>
        <!-- 左导航栏 -->
        <div id="aside-nav" class="hidden fixed top-0 w-3/4 max-w-xs px-4 z-20 overscroll-contain border-r overflow-y-auto h-screen md:h-[calc(100vh-var(--app-header-height))] md:w-full md:max-w-none md:top-[3.5rem] md:sticky md:hidden">
            <div class="drawer-body space-y-4">
                <div class="md:hidden space-y-1.5 border-b pb-3">
                    
    
    

                </div>
            </div>
        </div>
        

        

<div class="mx-auto max-w-screen-md mb-10 space-y-2 px-4 lg:px-8 pt-3">
  

  
  <div class="">
    
    <div class="text-zinc-400 text-[0.9em]">
        
        
        <a class="text-zinc-700" href="/">
            首页
             </a> 
        
         &raquo; 
        <a class="text-zinc-700" href="/blog/">
            博客
             </a> 
        
    </div>

  </div>
  

  <h1 class="text-2xl font-semibold pt-2">Ubuntu&#x2F;Linux 三板斧</h1>

  <div class="flex flex-col md:flex-row md:gap-4 text-[0.9em] text-gray-500">
    <div class="">
      
        <span>
        2024-04-07 14:10:00
        <em>更新</em>
        </span>
      
    </div>
  </div>
  <div class="markdown-body pt-4">
    <p><em>本页目录</em></p>
<div class="md-toc"><ul>
<li><a href="#wei-suo-you-yong-hu-zeng-jia-huan-jing-bian-liang">为所有用户增加环境变量</a></li>
<li><a href="#yong-jiu-geng-gai-host-name">永久更改 Host Name</a></li>
<li><a href="#sshmi-yao-yu-gitlian-jie">ssh秘钥与git连接</a></li>
<li><a href="#shi-yong-luo-ji-juan-guan-li-ying-pan-fen-qu-jia-zhuang-ying-pan-hou-xi-tong-kuo-rong">使用逻辑卷管理硬盘分区，加装硬盘后系统扩容</a></li>
<li><a href="#sshyu-socks5dai-li">ssh与socks5代理</a></li>
<li><a href="#sshfan-xiang-dai-li">ssh反向代理</a></li>
<li><a href="#zhao-hui-sshgong-yao">找回ssh公钥</a></li>
<li><a href="#gao-xiao-ya-suo-gong-ju-zhi-xz">高效压缩工具之xz</a></li>
<li><a href="#jia-zai-huan-jing-bian-liang">加载环境变量</a></li>
</ul>
</div>
<p>记录我的Ubuntu三板斧技能</p>
<h1>为所有用户增加环境变量<a name="wei-suo-you-yong-hu-zeng-jia-huan-jing-bian-liang" href="#wei-suo-you-yong-hu-zeng-jia-huan-jing-bian-liang" class="heading-anchor"></a></h1>
<p>将变量键值对写入 <code>/etc/environment</code>。查看如下：</p>
<pre><code class="language-bash">root@y5:~# cat /etc/environment
PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin"
LOCAL_IP="10.0.4.11"
</code></pre>
<h1>永久更改 Host Name<a name="yong-jiu-geng-gai-host-name" href="#yong-jiu-geng-gai-host-name" class="heading-anchor"></a></h1>
<pre><code class="language-bash"># 写入新的HostName到文件 /etc/hostname
echo dayu &gt; /etc/hostname

# 显示当前HostName
root@y5:~# hostname
y5

# 查看包括HostName在内系统信息
root@y5:~# hostnamectl
 Static hostname: y5
 Pretty hostname: y5.liveio.cn
       Icon name: computer-vm
         Chassis: vm
      Machine ID: 8053f6f3b11c4c898c03c8dac1ce1ac3
         Boot ID: b1a053915d01402c90fd11c2c43870d1
  Virtualization: kvm
Operating System: Ubuntu 22.04 LTS
          Kernel: Linux 5.15.0-72-generic
    Architecture: x86-64
 Hardware Vendor: Tencent Cloud
  Hardware Model: CVM

</code></pre>
<p>Pretty hostname 保存在：<code>/etc/machine-info</code>。某些情况下需要引用该HostName，还需要在 <code>/etc/hosts</code> 文件中增加该地址解析。</p>
<h1>ssh秘钥与git连接<a name="sshmi-yao-yu-gitlian-jie" href="#sshmi-yao-yu-gitlian-jie" class="heading-anchor"></a></h1>
<pre><code class="language-bash"># 测试私钥是否有权限连接服务器
ssh -T git@dev.liveio.cn -p 2222 -i id_rsa.key

# 使用指定秘钥clone代码库
ssh-agent bash -c 'ssh-add /data/liveio/src/id_ed25519_devops; git clone  ssh://git@github.com/daobox/wz-app.git'

# 生成新的私钥
ssh-keygen -t ed25519 -C "devops@liveio.cn" -m PEM

</code></pre>
<h1>使用逻辑卷管理硬盘分区，加装硬盘后系统扩容<a name="shi-yong-luo-ji-juan-guan-li-ying-pan-fen-qu-jia-zhuang-ying-pan-hou-xi-tong-kuo-rong" href="#shi-yong-luo-ji-juan-guan-li-ying-pan-fen-qu-jia-zhuang-ying-pan-hou-xi-tong-kuo-rong" class="heading-anchor"></a></h1>
<p>查看当前逻辑分区信息：</p>
<pre><code class="language-bash">root@dev-liveio:~# lsblk
NAME                      MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
loop0                       7:0    0  55.6M  1 loop /snap/core18/2745
loop1                       7:1    0  55.6M  1 loop /snap/core18/2751
loop2                       7:2    0  63.3M  1 loop /snap/core20/1879
loop3                       7:3    0  63.5M  1 loop /snap/core20/1891
loop4                       7:4    0   103M  1 loop /snap/lxd/23541
loop5                       7:5    0 111.9M  1 loop /snap/lxd/24322
loop6                       7:6    0  53.2M  1 loop /snap/snapd/19122
loop7                       7:7    0  53.3M  1 loop /snap/snapd/19361
sda                         8:0    0 931.5G  0 disk
└─sda1                      8:1    0 931.5G  0 part
sdb                         8:16   0 111.8G  0 disk
├─sdb1                      8:17   0     1G  0 part /boot/efi
├─sdb2                      8:18   0     2G  0 part /boot
└─sdb3                      8:19   0 108.7G  0 part
  └─ubuntu--vg-ubuntu--lv 253:0    0     1T  0 lvm  /
sdc                         8:32   0 953.9G  0 disk
└─sdc1                      8:33   0 953.9G  0 part
  └─ubuntu--vg-ubuntu--lv 253:0    0     1T  0 lvm  /
</code></pre>
<p>要增加 Ubuntu 上的卷组（Volume Group）的大小，你可以按照以下步骤进行操作：</p>
<ol>
<li>
<p>连接硬盘：将新的硬盘连接到计算机，并确保系统正确识别了它（可以使用 <code>sudo fdisk -l</code> 命令进行检查）。</p>
</li>
<li>
<p>创建物理卷（Physical Volume）：使用 <code>pvcreate</code> 命令创建新的物理卷。假设新硬盘的设备路径是 <code>/dev/sdX</code>，可以使用以下命令创建物理卷：</p>
<pre><code class="language-bash">sudo pvcreate /dev/sdX
</code></pre>
</li>
<li>
<p>将物理卷添加到现有的卷组：使用 <code>vgextend</code> 命令将新创建的物理卷添加到现有的卷组中。假设现有卷组的名称是 <code>myvg</code>，可以使用以下命令将物理卷添加到该卷组：</p>
<pre><code class="language-bash">sudo vgextend myvg /dev/sdX
</code></pre>
</li>
<li>
<p>扩展卷组的逻辑卷：一旦物理卷添加到了卷组中，你可以使用 <code>lvextend</code> 命令来扩展卷组中逻辑卷的大小。假设要扩展的逻辑卷名称是 <code>mylv</code>，可以使用以下命令扩展该逻辑卷的大小：</p>
<pre><code class="language-bash">sudo lvextend -l +100%FREE /dev/myvg/mylv
</code></pre>
<p>上述命令中的 <code>-l +100%FREE</code> 指定将逻辑卷扩展到卷组中可用的所有剩余空间。</p>
</li>
<li>
<p>扩展文件系统：最后一步是扩展逻辑卷上的文件系统，以便可以利用新增的空间。根据使用的文件系统类型，你可以使用适当的命令进行扩展。例如，对于 ext4 文件系统，可以使用 <code>resize2fs</code> 命令进行扩展：</p>
<pre><code class="language-bash">sudo resize2fs /dev/myvg/mylv
</code></pre>
</li>
</ol>
<p>完成上述步骤后，卷组的大小应该已成功增加，并且逻辑卷和文件系统已经占用了新增的空间。</p>
<p>请注意，在进行任何操作之前，请确保你了解自己的硬件和系统要求，并小心谨慎地操作。此外，确保你对 LVM 的操作非常熟悉，以免不小心删除或修改了错误的卷。建议在操作前进行充分的测试和验证，并备份重要数据。</p>
<p>Ref: <a href="https://blog.yqxpro.com/2021/10/31/%E9%80%9A%E8%BF%87LVM%E7%BB%99Ubuntu%E6%B7%BB%E5%8A%A0%E7%A1%AC%E7%9B%98%E7%A9%BA%E9%97%B4/">https://blog.yqxpro.com/2021/10/31/%E9%80%9A%E8%BF%87LVM%E7%BB%99Ubuntu%E6%B7%BB%E5%8A%A0%E7%A1%AC%E7%9B%98%E7%A9%BA%E9%97%B4/</a></p>
<h1>ssh与socks5代理<a name="sshyu-socks5dai-li" href="#sshyu-socks5dai-li" class="heading-anchor"></a></h1>
<pre><code class="language-bash"># 本地拨入远程主机，并打开一个Socks5代理
ssh  -p 11022 -D 127.0.0.1:1337 -N root@y4.dayu.me
</code></pre>
<p><strong>参数</strong></p>
<ul>
<li><code>p</code>: 远程主机ssh端口</li>
<li><code>D</code>: 本地监听的地址与端口</li>
<li><code>N</code>: 不执行命令，仅作端口转发</li>
</ul>
<h1>ssh反向代理<a name="sshfan-xiang-dai-li" href="#sshfan-xiang-dai-li" class="heading-anchor"></a></h1>
<pre><code class="language-bash"># 将本地的9080端口反向拨入到远程主机y4.dayu.me的5001端口，远程主机的ssh端口为11022。
# 最后的作用是：y4.dayu.me:5001  -&gt; localhost:9080
ssh -CNR 5001:localhost:9080 root@y4.dayu.me -p 11022
</code></pre>
<h1>找回ssh公钥<a name="zhao-hui-sshgong-yao" href="#zhao-hui-sshgong-yao" class="heading-anchor"></a></h1>
<pre><code class="language-bash">ssh-keygen -y -f ~/.ssh/id_rsa &gt; ~/.ssh/id_rsa.pub
</code></pre>
<p><strong>ref</strong>:</p>
<ul>
<li><a href="https://www.jianshu.com/p/84645538b639">如何找回ssh公钥 - 简书</a></li>
</ul>
<h1>高效压缩工具之xz<a name="gao-xiao-ya-suo-gong-ju-zhi-xz" href="#gao-xiao-ya-suo-gong-ju-zhi-xz" class="heading-anchor"></a></h1>
<p>高压缩率的工具，它使用 LZMA2 压缩算法，生成的压缩文件比传统使用的 gzip、bzip2 生成的压缩文件更小，
详情见<a href="https://tukaani.org/xz/">官网</a>。</p>
<pre><code class="language-bash">xz [选项] [参数]
</code></pre>
<p>主要参数说明：</p>
<pre><code class="language-bash">-z --compress  # 强制压缩
-d --decompress # 解压缩
-t --test # 测试压缩文件的完整性
-k --keep # 压缩或解压时保持源文件不被删除
-l --list # 列出有关.xz文件的信息
-0~9 # 指定压缩率，默认为6;
-h --help # 显示这个简洁的帮助并退出
-H --long-help # 显示更多帮助（还列出了高级选项）
-V --version # 显示版本号并退出
</code></pre>
<p>eg: <sup class="footnote-ref"><a href="#fn-1" id="fnref-1" data-footnote-ref>1</a></sup></p>
<pre><code class="language-bash"># xz压缩
xz nohup.log

# 解压使用-d参数，如果保留源文件可以加-k
xz -dk nohup.log.xz 

# 参数 -l 显示 .xz 文件的压缩率、数据完整性验证方式等基本信息
xz -l nohup.log.xz 

# xzcat对已压缩日志直接查看并过滤，或者 xzgrep 直接过滤
xzcat nohup.log.xz | grep "18:29"
</code></pre>
<h1>加载环境变量<a name="jia-zai-huan-jing-bian-liang" href="#jia-zai-huan-jing-bian-liang" class="heading-anchor"></a></h1>
<p>从当前目录中的 <code>.env</code> 文件中加载环境变量</p>
<pre><code class="language-bash">export $(grep -v '^#' .env | xargs -0)
</code></pre>
<section class="footnotes" data-footnotes>
<ol>
<li id="fn-1">
<p><a href="https://www.ruanyifeng.com/blog/2005/09/egie.html">你能分清e.g.和i.e.吗？ - 阮一峰的网络日志</a> <a href="#fnref-1" class="footnote-backref" data-footnote-backref aria-label="Back to content">↩</a></p>
</li>
</ol>
</section>

  </div>
</div>


        
        <div class="footer text-center space-y-2">
    <div class="footer-nav text-sm">
        
    </div>
    <div class="!text-gray-500 text-xs flex gap-3 justify-center">
        
        
        
    </div>
</div>
        
    </div>


    
    <script src="/assets/main.dc2e1209.js"></script>
    

    <link rel="stylesheet" href="https://jsdelivr.daobox.cc/combine/npm/prismjs@1.29.0/themes/prism-solarizedlight.css,npm/prismjs@1.29.0/plugins/toolbar/prism-toolbar.min.css">
<script src="https://jsdelivr.daobox.cc/combine/npm/prismjs@1.29.0/components/prism-core.min.js,npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js,npm/prismjs@1.29.0/plugins/toolbar/prism-toolbar.min.js,npm/prismjs@1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
<script>
  Prism.plugins.autoloader.languages_path = 'https://jsdelivr.daobox.cc/npm/prismjs@1.29.0/components/';
</script>
    
</body>

